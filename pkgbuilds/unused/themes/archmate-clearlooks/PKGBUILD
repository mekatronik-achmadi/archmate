pkgname=archmate-clearlooks
pkgver=7.0.1
pkgrel=1
_iconpkg=mist-icon-theme
_iconver=3.0.0+20+gaaba3bb
_commit=aaba3bb83add369a480f393a8d0907f6ea72b285
pkgdesc="GTK3 theme visually close to Clearlooks"
arch=('any')
url="https://github.com/jpfleury/clearlooks-phenix"
license=('GPL')
depends=('gtk-engine-murrine' 'gtk-update-icon-cache' 'mate-icon-theme')
makedepends=('git' 'gtk-engines' 'icon-naming-utils' 'gnome-common')
provides=('clearlooks-phenix-gtk-theme' 'mist-icon-theme')
conflicts=('clearlooks-phenix-gtk-theme' 'mist-icon-theme')
install=pkg.install
changelog=
source=(
"https://github.com/jpfleury/clearlooks-phenix/archive/${pkgver}.tar.gz"
"git+https://gitlab.gnome.org/Archive/gnome-themes.git#commit=${_commit}")
md5sums=('SKIP' 'SKIP')

prepare() {
  cd "$srcdir/clearlooks-phenix-${pkgver}"

  patch -p1 < ../../patches/001.patch
  patch -p1 < ../../patches/002.patch
  patch -p1 < ../../patches/003.patch
  patch -p1 < ../../patches/004.patch
  patch -p1 < ../../patches/005.patch
  patch -p1 < ../../patches/006.patch

  cd "$srcdir/gnome-themes"

  git revert --no-commit 7c840124d0ed9e946fd7713f8a5761ea40a741f5

  sed -i 's|Inherits=gnome|Inherits=mate|g' \
  $srcdir/gnome-themes/icon-themes/Mist/index.theme.in
}

build () {
  cd "$srcdir/gnome-themes"

  ./autogen.sh --prefix=/usr --disable-dependency-tracking
  make -C icon-themes/Mist
}

package() {
  cd "$srcdir/clearlooks-phenix-${pkgver}"

  mkdir -p "${pkgdir}/usr/share/themes/Clearlooks-Phenix"
  cp -a gtk-2.0 gtk-3.0 metacity-1 openbox-3 wallpapers \
     "${pkgdir}/usr/share/themes/Clearlooks-Phenix"

  cp -a ../../Standard-Clearlooks.theme \
     "${pkgdir}/usr/share/themes/Clearlooks-Phenix/index.theme"

  cd "$srcdir/gnome-themes"

  make DESTDIR="${pkgdir}" -C icon-themes/Mist install
}

